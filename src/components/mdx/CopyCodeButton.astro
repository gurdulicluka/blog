---
import { Icon } from "astro-icon";
---

<button
  data-copyCodeBtn
  name="Copy code block to clipboard"
  aria-label="Copy code block to clipboard"
  class="p-2 lg:hover:outline-neutral-600 outline outline-2 outline-transparent animate__animated bg-neutral-700 absolute top-2 right-2 rounded-lg w-fit h-fit disabled:pointer-events-none transition"
>
  <div data-copyIcon>
    <Icon
      class="[&>path]:fill-neutral-300"
      pack="mdi"
      name="clipboard-multiple-outline"
      height="20"
    />
  </div>
  <div data-copySuccess class="animate__animated animate__bounceIn hidden">
    <Icon
      class="[&>path]:fill-success"
      pack="mdi"
      name="clipboard-check-multiple-outline"
      height="20"
    />
  </div>
</button>

<script>
  import copy from "copy-to-clipboard";

  const buttons = document.querySelectorAll(
    "[data-copyCodeBtn]"
  ) as NodeListOf<HTMLButtonElement>;

  buttons.forEach((button) => {
    const codeBlock = button.closest("[data-codeBlock]") as HTMLElement;
    const copyIcon = button.querySelector("[data-copyIcon]") as HTMLElement;
    const copySuccess = button.querySelector(
      "[data-copySuccess]"
    ) as HTMLElement;
    let text = codeBlock.querySelector("code")!.innerText;

    button.addEventListener("click", () => {
      copy(text);
      button.classList.remove("outline-transparent");
      button.classList.add("outline-success");
      copySuccess.classList.toggle("hidden");
      copyIcon.classList.toggle("hidden");
      button.disabled = true;

      setTimeout(() => {
        //TODO outline not working green
        button.classList.add("outline-transparent");
        button.classList.remove("outline-success");
        copySuccess.classList.toggle("hidden");
        copyIcon.classList.toggle("hidden");
        button.disabled = false;
      }, 2000);
    });
  });
</script>
